<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<input type="text" id="search-bar" style="display: block"/>

<pre id="highlight-bar"></pre>

<script type="application/javascript">

    let timeout = 0;
    let abort = new AbortController();
    let signal = abort.signal;

    document.getElementById("search-bar").addEventListener("input", (ev) => {
        let str = ev.target.value;

        clearTimeout(timeout);
        abort.abort();
        abort = new AbortController();
        signal = abort.signal;
        timeout = setTimeout(() => {
            fetch("/search/?q=" + str,
                {signal: signal}
            ).then(response => response.json()).then(text => {
                formattedtext = JSON.stringify(text.data, null, 3);
                id = text.id;
                document.getElementById("highlight-bar").innerHTML = formattedtext;

                fetch("/highlight/?id=" + id).then(response => response.json()).then(response => {
                    for (v in response) {
                        for (hg in response[v]) {
                            let newresp = response[v][hg].replace(/(<([^>]+)>)/gi, "");
                            newresp = newresp.replace(/\(\(\(/gi, "<mark>");
                            newresp = newresp.replace(/\)\)\)/gi, "</mark>");
                            response[v][hg] = newresp;
                        }
                    }

                    document.getElementById('highlight-bar').innerHTML = JSON.stringify(response, null, 3);
                })
            })
        }, 50);
    })
</script>
</body>
</html>